import{r as D,m as J,o as v}from"./CE_BPai5.js";import{w as E,d as M}from"./B4nVmeH8.js";function L(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function U(n,w){n.d(1),w.delete(n.key)}function C(n,w,l,o,g,r,d,b,S,p,h,I){let f=n.length,e=r.length,t=f;const c={};for(;t--;)c[n[t].key]=t;const s=[],i=new Map,y=new Map,F=[];for(t=e;t--;){const a=I(g,r,t),u=l(a);let m=d.get(u);m?F.push(()=>m.p(a,w)):(m=p(u,a),m.c()),i.set(u,s[t]=m),u in c&&y.set(u,Math.abs(t-c[u]))}const R=new Set,O=new Set;function P(a){J(a,1),a.m(b,h),d.set(a.key,a),h=a.first,e--}for(;f&&e;){const a=s[e-1],u=n[f-1],m=a.key,T=u.key;a===u?(h=a.first,f--,e--):i.has(T)?!d.has(m)||R.has(m)?P(a):O.has(T)?f--:y.get(m)>y.get(T)?(O.add(m),P(a)):(R.add(T),f--):(S(u,d),f--)}for(;f--;){const a=n[f];i.has(a.key)||S(a,d)}for(;e;)P(s[e-1]);return D(F),s}function N(){const n="people-table-v1",w=E(!0),l=E(""),o=E([]),g=E(!1);let r=null,d=0;const b=3;function S(e){return new Promise((t,c)=>{try{localStorage.setItem(n,JSON.stringify(e)),t()}catch(s){c(s)}})}async function p(e){g.set(!0),l.set("");try{await S(e),d=0}catch(t){if(d<b)return d++,await new Promise(c=>setTimeout(c,1e3*d)),p(e);throw t}finally{g.set(!1)}}if(typeof window<"u")try{const e=localStorage.getItem(n);e&&o.set(JSON.parse(e))}catch(e){l.set(e instanceof Error?e.message:"Failed to load data")}finally{w.set(!1)}function h(){r&&(clearTimeout(r),r=null)}const I=M([o,w,l,g],([e,t,c,s])=>({data:e,loading:t,error:c,saving:s}));return{subscribe:e=>{const t=I.subscribe(e);return()=>{h(),t()}},set:o.set,load:()=>{if(w.set(!0),typeof window>"u"){w.set(!1);return}try{const e=localStorage.getItem(n);e&&o.set(JSON.parse(e))}catch(e){l.set(e instanceof Error?e.message:"Failed to load data")}finally{w.set(!1)}},save:e=>{if(!(typeof window>"u"))try{const t=e;localStorage.setItem(n,JSON.stringify(t)),o.set(t),l.set("")}catch(t){l.set(t instanceof Error?t.message:"Failed to save data")}},add:e=>{const t=crypto.randomUUID(),c={...e,id:t};o.update(s=>[c,...s]),r&&clearTimeout(r),r=setTimeout(async()=>{try{const s=v(o);await p(s)}catch(s){l.set(s instanceof Error?s.message:"Failed to save data"),o.update(i=>i.filter(y=>y.id!==t))}},300)},update:(e,t)=>{const c=v(o),s=c.findIndex(i=>i.id===e);s!==-1&&(o.update(i=>{const y=[...i];return y[s]={...i[s],...t},y}),r&&clearTimeout(r),r=setTimeout(async()=>{try{const i=v(o);await p(i)}catch(i){l.set(i instanceof Error?i.message:"Failed to save data"),o.set(c)}},300))},remove:e=>{const t=v(o);t.find(s=>s.id===e)&&(o.update(s=>s.filter(i=>i.id!==e)),r&&clearTimeout(r),r=setTimeout(async()=>{try{const s=v(o);await p(s)}catch(s){l.set(s instanceof Error?s.message:"Failed to save data"),o.set(t)}},300))}}}const G=N();export{U as d,L as e,G as p,C as u};
